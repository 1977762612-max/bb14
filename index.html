<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>案件：删库跑路</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --primary: #2d8cf0; /* 科技蓝 */
            --danger: #ed4014;
            --text-main: #17233d;
            --text-sub: #515a6e;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 15px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* 手机端靠上对齐更好 */
        }

        .container {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 600px; /* 限制最大宽度，平板/电脑也不丑 */
            padding: 25px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            box-sizing: border-box;
        }

        .hidden { display: none; }

        h1 {
            font-size: 20px;
            margin: 0 0 15px 0;
            color: var(--text-main);
            text-align: center;
            border-bottom: 2px solid #f8f8f9;
            padding-bottom: 10px;
        }
        
        h2 { font-size: 18px; margin-top: 0; }
        p { font-size: 15px; line-height: 1.6; color: var(--text-sub); margin-bottom: 15px; }

        /* 大按钮，适合手指点击 */
        .btn {
            background: var(--primary);
            color: white;
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            /* 点击反馈 */
            active: scale(0.98); 
            transition: opacity 0.2s;
        }
        .btn:active { opacity: 0.8; }

        .btn-skip {
            background: transparent;
            color: var(--danger);
            border: 1px dashed var(--danger);
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
        }

        /* 卡片式列表 */
        .profile-card {
            background: #f8f8f9;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            border-left: 4px solid var(--primary);
        }
        .profile-name { font-weight: bold; font-size: 15px; display: block; margin-bottom: 4px; }
        .profile-desc { font-size: 13px; color: #808695; }

        /* 进度条区域 */
        .loader-box { margin: 30px 0; }
        .loader-track {
            width: 100%;
            height: 10px;
            background: #e8eaec;
            border-radius: 5px;
            overflow: hidden;
        }
        .loader-fill {
            width: 0%;
            height: 100%;
            background: var(--primary);
            border-radius: 5px;
        }

        /* 动画配置 (逻辑不变) */
        .mode-linear .loader-fill { transition: width 8000ms linear; }
        .mode-fast-start .loader-fill { transition: width 8000ms cubic-bezier(0.1, 0.9, 0.2, 1.0); }
        .mode-peak-end .loader-fill { transition: width 8000ms cubic-bezier(0.8, 0, 0.9, 1); }

        /* 验证码区域 */
        #math-challenge {
            background: #fff;
            padding: 20px;
            border: 1px solid #dcdee2;
            border-radius: 8px;
            text-align: center;
        }
        input[type="number"] {
            padding: 10px;
            width: 80px;
            font-size: 18px;
            text-align: center;
            border: 1px solid #dcdee2;
            border-radius: 4px;
            margin: 0 5px;
        }

        /* 单选框优化 */
        label {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #f8f8f9;
            border-radius: 8px;
            margin-bottom: 10px;
            /* 增大点击热区 */
            cursor: pointer; 
        }
        input[type="radio"] { margin-right: 10px; transform: scale(1.2); }

        /* 结果与导出 */
        .result-box {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #bdf;
            margin: 15px 0;
        }
        .stamp {
            font-size: 18px;
            font-weight: bold;
            display: inline-block;
            padding: 4px 10px;
            border: 2px solid;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .stamp-success { color: #19be6b; border-color: #19be6b; }
        .stamp-fail { color: #ed4014; border-color: #ed4014; }

        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            border: 1px solid #dcdee2;
            border-radius: 6px;
            font-size: 12px;
            background: #f8f8f9;
            box-sizing: border-box; /* 防止撑破容器 */
        }
    </style>
</head>
<body>

<div class="container" id="game-container">
    
    <div id="stage-intro" class="main-stage">
        <h1>案件：公司删库事件</h1>
        <p>昨晚，公司核心数据库被恶意清空，备份也被覆盖。CTO 让你立刻调查三名有权限的嫌疑人。</p>
        
        <div class="profile-card">
            <span class="profile-name">嫌疑人 A：新来实习生</span>
            <span class="profile-desc">动机：操作不熟练，案发前被看到在手忙脚乱地修Bug。</span>
        </div>
        <div class="profile-card">
            <span class="profile-name">嫌疑人 B：被裁程序员</span>
            <span class="profile-desc">动机：昨天刚收到裁员通知，扬言要“给公司留点纪念”。</span>
        </div>
        <div class="profile-card">
            <span class="profile-name">嫌疑人 C：运维主管</span>
            <span class="profile-desc">动机：外表老实，但最近急需用钱。</span>
        </div>

        <button class="btn" onclick="nextRound()">开始恢复日志</button>
    </div>

    <div id="stage-loading" class="main-stage hidden" onclick="handleFidget(event)">
        <h2 id="loading-title" style="text-align:center;">正在恢复数据...</h2>
        <div class="loader-box">
            <div class="loader-track"><div class="loader-fill" id="progBar"></div></div>
        </div>
        
        <div id="skip-wrapper">
            <button class="btn-skip" onclick="clickSkip()">⚠ 系统卡顿？点击启用管理员通道</button>
        </div>

        <div id="math-challenge" class="hidden">
            <p><strong>管理员身份验证</strong></p>
            <div style="margin: 15px 0;">
                <span id="math-question" style="font-size: 20px; font-weight: bold; letter-spacing: 2px;"></span> = ?
            </div>
            <input type="number" id="math-answer" placeholder="结果">
            <button class="btn" style="margin-top:15px;" onclick="checkMath()">确认验证</button>
        </div>
    </div>

    <div id="stage-clue" class="main-stage hidden">
        <h2>恢复成功</h2>
        <p style="color:#2d8cf0; font-weight:bold;" id="clue-meta"></p>
        <div style="background:#fff; border:1px solid #eee; padding:15px; border-radius:8px;">
            <p id="clue-text" style="margin:0; color:#333;"></p>
        </div>
        <button class="btn" onclick="nextRound()">继续</button>
    </div>

    <div id="stage-deduction" class="main-stage hidden">
        <h1>结案报告</h1>
        <p>根据恢复的日志，谁是真凶？</p>
        <label><input type="radio" name="suspect" value="实习生"> 实习生 (误操作)</label>
        <label><input type="radio" name="suspect" value="被裁员工"> 被裁程序员 (报复)</label>
        <label><input type="radio" name="suspect" value="运维主管"> 运维主管 (倒卖数据)</label>
        <button class="btn" onclick="submitVerdict()">提交报告</button>
    </div>

    <div id="stage-result" class="main-stage hidden">
        <div id="result-header" style="text-align: center;"></div>
        <div class="result-box">
            <p id="result-message" style="font-weight:bold; margin-bottom:10px;"></p>
            <div style="font-size:13px; color:#666; border-top:1px solid #ccc; padding-top:10px;">
                <strong>真相还原：</strong><br>
                真凶是<b>运维主管</b>。<br><br>
                1. 实习生虽然菜，但他没有核心权限删除备份。<br>
                2. 被裁员工的账号在离职即刻就被冻结了，无法登录。<br>
                3. 日志显示，操作是用<b>主管的物理密钥</b>进行的，且数据在删除前被打包上传到了海外网盘（为了卖钱）。
            </div>
        </div>
        <button class="btn" onclick="goToExport()">生成实验数据</button>
    </div>

    <div id="stage-export" class="main-stage hidden">
        <h2>实验结束</h2>
        <p>请复制下方代码：</p>
        <textarea id="final-data" readonly></textarea>
        <button class="btn" id="copy-btn" onclick="copyData()">一键复制</button>
    </div>
</div>

<script>
    // --- 极简文案配置 ---
    const clues = [
        { meta: "日志片段 1/3", text: "系统显示：‘核心数据库’是被永久删除的，而不是格式化。这种操作需要最高级别的物理密钥（U盾）插入服务器才能执行。" },
        { meta: "日志片段 2/3", text: "账号记录显示：被裁程序员的账号在昨天下午 17:00 就已经被HR冻结了，案发时他根本无法登录系统。" },
        { meta: "日志片段 3/3", text: "流量分析：在数据被删除的前10分钟，服务器有大量数据流出，目的地是一个境外的匿名网盘。这不是报复泄愤，这是为了偷数据卖钱。" }
    ];
    
    const loadingTexts = [
        "正在扫描操作日志...",
        "正在核对账号权限...",
        "正在追踪网络流量..."
    ];
    
    // 简单的数学题
    const mathQs = [ {q: "10 + 20", a: 30}, {q: "5 x 6", a: 30}, {q: "50 - 5", a: 45} ];

    let currentRound = 0;
    
    // --- 核心逻辑 ---
    const urlParams = new URLSearchParams(window.location.search);
    const assignedGroup = urlParams.get('g') ? parseInt(urlParams.get('g')) : Math.floor(Math.random() * 3) + 1;

    let experimentData = {
        group: assignedGroup, 
        rounds: [], 
        finalChoice: "",
        isCorrect: false,
        startTime: Date.now()
    };

    let waitStartTime, waitTimeout, currentVerifErrors = 0, currentFidgetClicks = 0, currentClickSkipTime = null;

    function nextRound() {
        if (currentRound < clues.length) {
            startWaiting();
        } else {
            switchStage('stage-deduction');
        }
    }

    function startWaiting() {
        if (waitTimeout) clearTimeout(waitTimeout);
        switchStage('stage-loading');
        
        if (currentRound < loadingTexts.length) {
            document.getElementById('loading-title').innerText = loadingTexts[currentRound];
        }

        const bar = document.getElementById('progBar');
        const container = document.getElementById('stage-loading');
        
        // UI重置
        document.getElementById('math-challenge').classList.add('hidden');
        document.getElementById('skip-wrapper').classList.remove('hidden');
        document.getElementById('math-answer').value = "";

        // 动画重置
        container.classList.remove('mode-linear', 'mode-fast-start', 'mode-peak-end');
        bar.style.transition = 'none'; 
        bar.style.width = "0%";
        
        void bar.offsetWidth; // 强制重绘
        bar.style.transition = ''; 

        // 延迟启动
        setTimeout(() => {
            if (experimentData.group === 1) container.classList.add('mode-linear');
            else if (experimentData.group === 2) container.classList.add('mode-fast-start');
            else if (experimentData.group === 3) container.classList.add('mode-peak-end');
            
            bar.style.width = "100%";
        }, 50);

        waitStartTime = Date.now();
        currentVerifErrors = 0;
        currentFidgetClicks = 0;
        currentClickSkipTime = null;

        waitTimeout = setTimeout(() => {
            finishWaiting(false);
        }, 8000);
    }

    function handleFidget(e) {
        if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT') return;
        currentFidgetClicks++;
    }

    function clickSkip() {
        if (currentClickSkipTime === null) {
            currentClickSkipTime = Date.now() - waitStartTime;
        }
        document.getElementById('math-question').innerText = mathQs[currentRound].q;
        document.getElementById('skip-wrapper').classList.add('hidden');
        document.getElementById('math-challenge').classList.remove('hidden');
    }

    function checkMath() {
        const val = parseInt(document.getElementById('math-answer').value);
        if (val === mathQs[currentRound].a) {
            clearTimeout(waitTimeout); 
            const bar = document.getElementById('progBar');
            bar.style.transition = 'width 200ms ease-out';
            bar.style.width = "100%";
            setTimeout(() => { finishWaiting(true); }, 200); 
        } else {
            currentVerifErrors++;
            alert("验证码错误");
            document.getElementById('math-answer').value = "";
        }
    }

    function finishWaiting(skipped) {
        if (waitTimeout) clearTimeout(waitTimeout);
        
        experimentData.rounds.push({
            round: currentRound + 1,
            skipped: skipped,
            verifErrors: currentVerifErrors,
            waitTime_ms: Date.now() - waitStartTime, 
            fidgetClicks: currentFidgetClicks,
            timeToClickSkip_ms: currentClickSkipTime 
        });
        
        document.getElementById('clue-meta').innerText = clues[currentRound].meta;
        document.getElementById('clue-text').innerText = clues[currentRound].text;
        switchStage('stage-clue');
        currentRound++;
    }

    function submitVerdict() {
        const sel = document.querySelector('input[name="suspect"]:checked');
        if (!sel) return alert("请选择一个嫌疑人");
        experimentData.finalChoice = sel.value;
        experimentData.isCorrect = (sel.value === "运维主管");
        
        const header = document.getElementById('result-header');
        const msg = document.getElementById('result-message');
        if (experimentData.isCorrect) {
            header.innerHTML = '<div class="stamp stamp-success">判断正确</div>';
            msg.innerText = "厉害！你成功锁定了内鬼。";
        } else {
            header.innerHTML = '<div class="stamp stamp-fail">判断错误</div>';
            msg.innerText = "很遗憾，真凶是运维主管。";
        }
        switchStage('stage-result');
    }

    function goToExport() {
        document.getElementById('final-data').value = JSON.stringify(experimentData, null, 2);
        switchStage('stage-export');
    }

    function switchStage(id) {
        document.querySelectorAll('.main-stage').forEach(el => el.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    function copyData() {
        const txt = document.getElementById('final-data');
        txt.select(); document.execCommand('copy');
        document.getElementById('copy-btn').innerText = "✅ 已复制";
    }
</script>
</body>
</html>
